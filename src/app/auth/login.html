<div class="login-page">
    <div class="login-card">
        <div class="login-header">
            <img src="metroreach-logo.png" alt="MetroReach" class="logo">
            <h2>Welcome Back</h2>
            <p>{{ isPasswordless ? 'Enter your email for a secure link' : 'Secure access to your admin dashboard' }}</p>
        </div>

        @if (!linkSent()) {
        <form (submit)="handleLogin()">
            <div class="form-group">
                <label>Email Address</label>
                <div class="input-wrapper">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="icon"
                        style="width: 18px; height: 18px; position: absolute; left: 16px;">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    <input type="email" [(ngModel)]="email" name="email" placeholder="admin@metroreach.com" required>
                </div>
            </div>

            @if (!isPasswordless) {
            <div class="form-group">
                <label>Password</label>
                <div class="input-wrapper">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="icon"
                        style="width: 18px; height: 18px; position: absolute; left: 16px;">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    <input type="password" [(ngModel)]="password" name="password" placeholder="••••••••" required>
                </div>
            </div>
            }

            @if (error()) {
            <div class="error-msg">{{ error() }}</div>
            }

            <button type="submit" class="btn-primary" [disabled]="isLoading()">
                @if (!isLoading()) {
                <span>{{ isPasswordless ? 'Send Magic Link' : 'Sign In' }}</span>
                } @else {
                <div class="spinner-small"></div>
                }
            </button>

            <div class="mode-toggle">
                <span>{{ isPasswordless ? 'Standard login?' : 'Forgotten password?' }}</span>
                <button type="button" (click)="toggleMode()">{{ isPasswordless ? 'Use Password' : 'Send Link Instead'
                    }}</button>
            </div>
        </form>
        } @else {
        <div class="success-message">
            <div class="check-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                    style="width: 32px; height: 32px;">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
            <h3>Check your email</h3>
            <p>We've sent a magic login link to <strong>{{ maskedEmail }}</strong>. Click the link to sign in instantly.
            </p>
            <button class="btn-primary" style="margin-top: 24px;" (click)="linkSent.set(false)">Back to login</button>
        </div>
        }
    </div>

    <div class="login-footer">
        <p>&copy; 2026 MetroReach Infrastructure Limited. All rights reserved.</p>
    </div>
</div>